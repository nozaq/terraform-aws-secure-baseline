name: Terraform
on:
  push:
    branches:
    - master
  pull_request:
jobs:
  check-format:
    name: Check format
    runs-on: ubuntu-latest
    steps:
    - uses: hashicorp/setup-terraform@v1
    - name: Checkout
      uses: actions/checkout@master
    - name: 'Terraform Format'
      run: terraform fmt -check

  validate-examples:
    name: Validate examples
    runs-on: ubuntu-latest
    steps:
    - uses: hashicorp/setup-terraform@v1
    - name: Checkout
      uses: actions/checkout@master

    - name: 'Terraform Init - examples/simple'
      run: terraform init
      working-directory: ./examples/simple
    - name: 'Terraform Validate - examples/simple'
      run: terraform validate
      working-directory: ./examples/simple

    - name: 'Terraform Init - examples/external-bucket'
      run: terraform init
      working-directory: ./examples/external-bucket
    - name: 'Terraform Validate - examples/external-bucket'
      run: terraform validate
      working-directory: ./examples/external-bucket

    - name: 'Terraform Init - examples/organization/master'
      run: terraform init
      working-directory: ./examples/organization/master
    - name: 'Terraform Validate - examples/organization/master'
      run: terraform validate
      working-directory: ./examples/organization/master

    - name: 'Terraform Init - examples/organization/member'
      run: terraform init
      working-directory: ./examples/organization/member
    - name: 'Terraform Validate - examples/organization/member'
      run: terraform validate
      working-directory: ./examples/organization/member
